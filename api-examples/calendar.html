<!DOCTYPE html>

<html>

<head>

	<head>
		<meta charset='utf-8'/>

		<link href='https://unpkg.com/@fullcalendar/core/main.css'
		      rel='stylesheet'/>
		<link href='https://unpkg.com/@fullcalendar/daygrid/main.css'
		      rel='stylesheet'/>

		<script src='https://unpkg.com/@fullcalendar/core/main.js'></script>
		<script src='https://unpkg.com/@fullcalendar/daygrid/main.js'></script>

		<script>
			var calendar = ''

            document.addEventListener('DOMContentLoaded', function () {
                var calendarEl = document.getElementById('calendar');

                calendar = new FullCalendar.Calendar(calendarEl, {
                    plugins: ['dayGrid'],
                });
                calendar.render();
                getCampusEventsAjax()
            });

            getCampusEventsAjax = () => {

                const Http = new XMLHttpRequest();
                const url = 'http://ford3.kartoza.com/api/v1/campus/1/';
                Http.open("GET", url);
                Http.send();
				let promise = new Promise(
                    function (resolve, reject) {
                        Http.onreadystatechange = (e) => {
                            resolve(JSON.parse(Http.responseText));

                        }});
				promise.then(function(result){getCampusEvents(result)});
            }

            getCampusEvents = (campus_data) => {

                let events = campus_data['campus_events']
                events.forEach(getEvent)
            }

            getEvent = (event, index) => {

                let start = event['date_start']
				let end = event['date_end']
                let cal_event = {
                    'id': event['id'],
                    'title': event['name'],
                    'start': start,
	                'end': end,
	                'url': event['http_link']
                }

                calendar.addEvent(cal_event)
            }


		</script>
	</head>
</head>

<body>
<div id='calendar'></div>
</body>

</html>

<script>

</script>
